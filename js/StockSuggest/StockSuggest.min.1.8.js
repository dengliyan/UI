/*
	功能描述：股票搜索提示建议
	发布日期：2015-12-04
	作    者：ly.deng
	版    本：1.8 
	修改说明：添加对余额情绪指数的支持
*/
!function(){var $Base,StockSuggest,Class={create:function(){return function(){this.initialize.apply(this,arguments)}}};Object.extend=function(a,b){for(property in b)a[property]=b[property];return a},Object.extend(Function.prototype,{bind:function(){var d,a=this,b=arguments[0],c=new Array;for(d=1;d<arguments.length;d++)c.push(arguments[d]);return function(){return a.apply(b,c)}}}),$Base={$:function(objName){return document.getElementById?eval('document.getElementById("'+objName+'")'):eval("document.all."+objName)},isIE:-1!=navigator.appVersion.indexOf("MSIE")?!0:!1,addEvent:function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)},delEvent:function(a,b,c){a.detachEvent?a.detachEvent("on"+b,c):a.removeEventListener(b,c,!1)},cE:function(a){return document.createElement(a)},getStyle:function(a,b){return a.currentStyle?a.currentStyle[b]:window.getComputedStyle?(propprop=b.replace(/([A-Z])/g,"-$1"),propprop=b.toLowerCase(),document.defaultView.getComputedStyle(a,null)[propprop]):null},offset:function(a){var e,b=0,c=0,d=a;for(c+=d.offsetTop,b+=d.offsetLeft,d=d.offsetParent;d.offsetParent;)e=($Base.getStyle(d,"position")||"").toLowerCase(),"absolute"!=e&&"relative"!=e&&(c+=d.offsetTop,b+=d.offsetLeft),d=d.offsetParent;return{left:b,top:c}},subString:function(a,b,c){if(c=c||!1,!a||!b)return"";var d=0,e=0,f="";for(e=0;e<a.length;e++){if(a.charCodeAt(e)>255?d+=2:d++,d>b)return c?f+"...":f;f+=a.charAt(e)}return a}},StockSuggest=Class.create(),Object.extend(StockSuggest.prototype,{initialize:function(a,b){var d,e,c=this;for(c.url="http://q.ssajax.cn/info/handler/xsuggesthandler.ashx",c.input=a,c.form=null,c.disabled=!1,c.columns={"选项":function(a,b){var f,g,c=/([\^|\$|\.|\*|\+|\?|\=|\!|\:|\\|\/|\(|\)|\[|\]|\{|\}])/gi,d=b.replace(c,"\\$1"),e=new RegExp("^"+d+".*$","im");for(f=0;3>f;f++)if(g=a[f],e.test(g))return g=$Base.subString(g,8),"string"==typeof g?g.replace(b.toUpperCase(),"<span style='color:#FF0000;float:none'>"+b.toUpperCase()+"</span>"):g;return a[0]},"代码":function(a){return a[0]},"简称":function(a){return a[1]},"拼音":function(a){return a[2]},"类型":function(a){return a[3]}},c._tableCssText={thead:{"选项":"width:60px;text-align:center","代码":"width:60px;text-align:center","简称":"text-align:left;padding-left:24px","拼音":"width:60px;text-align:center","类型":"width:60px;text-align:center"},tbody:{"选项":"text-align:center","代码":"text-align:center","简称":"text-align:left;padding-left:12px","拼音":"text-align:center","类型":"text-align:center"}},c._shortKeyMap={"03":"http://index.quote.stockstar.com/000001.shtml","04":"http://index.quote.stockstar.com/399001.shtml","06":"http://quote.stockstar.com/stock/fav/favorite.htm",1:"http://quote.stockstar.com/stock/sha.shtml",2:"http://quote.stockstar.com/stock/shb.shtml",3:"http://quote.stockstar.com/stock/sza.shtml",4:"http://quote.stockstar.com/stock/szb.shtml",5:"http://quote.stockstar.com/stock/ranklist_shbond_1_0_1.html",6:"http://quote.stockstar.com/stock/ranklist_szbond_1_0_1.html",7:"http://quote.stockstar.com/stock/ranklist_a_1_0_1.html",8:"http://quote.stockstar.com/stock/ranklist_b_1_0_1.html",9:"http://quote.stockstar.com/stock/small.shtml",40:"http://quote.stockstar.com/fund/closed.shtml",41:"http://quote.stockstar.com/fund/open.shtml",42:"http://quote.stockstar.com/fund/etf.shtml",43:"http://quote.stockstar.com/fund/lof.shtml",60:"http://quote.stockstar.com/stock/ranklist_a.shtml",61:"http://quote.stockstar.com/stock/ranklist_sha.shtml",62:"http://quote.stockstar.com/stock/ranklist_shb.shtml",63:"http://quote.stockstar.com/stock/ranklist_sza.shtml",64:"http://quote.stockstar.com/stock/ranklist_szb.shtml",65:"http://quote.stockstar.com/stock/ranklist_shbond.shtml",66:"http://quote.stockstar.com/stock/ranklist_szbond.shtml",67:"http://quote.stockstar.com/stock/ranklist_gem.shtml",68:"http://quote.stockstar.com/stock/ranklist_b.shtml",69:"http://quote.stockstar.com/stock/ranklist_small.shtml",80:"http://quote.stockstar.com/stock/rank_a.shtml",81:"http://quote.stockstar.com/stock/rank_sha.shtml",82:"http://quote.stockstar.com/stock/rank_shb.shtml",83:"http://quote.stockstar.com/stock/rank_sza.shtml",84:"http://quote.stockstar.com/stock/rank_szb.shtml",87:"http://quote.stockstar.com/stock/rank_gem.shtml",89:"http://quote.stockstar.com/stock/rank_small.shtml",180:"http://index.quote.stockstar.com/000010.shtml",100:"http://index.quote.stockstar.com/399004.shtml",300:"http://index.quote.stockstar.com/000300.shtml",50:"http://index.quote.stockstar.com/000016.shtml"},c._U=null,c._hidden=!1,c._cache={},c._enabled=!0,c._index=-1,c.copyright={version:"1.8",author:"ly.deng"},c.setOptions(b),d=[],e=0;e<c.options.header.columns.length;e++)"选项"!=c.options.header.columns[e]&&d.push(c.options.header.columns[e]);c.options.header.columns=d,c.init()},setOptions:function(a){this.options={width:"220px",opacity:1,multiple:!1,className:"",text:"代码/拼音/简称",rows:10,types:[101,102,103,104,105,201,300,401,403,405,501,502,503,504,801,802,9001],status:[1],shortcutKey:!1,orderBy:2,resultVar:"result",header:{show:!0,columns:["选项","简称","类型"]},more:!0,autoSubmit:!0,evt:!1,callback:function(){}},Object.extend(this.options,a||{})},init:function(){var a,b;if(this.input="string"==typeof this.input?$Base.$(this.input):this.input,!this.input)throw new Error("无对象");this.input.value=this.options.text,this.input.setAttribute("autocomplete","off"),this.input.autoComplete="off",this.input.style.color="#999",this.input.autoComplete="off",this.input.name="code",null==this.form&&(a=this.input.parentNode,"form"==a.nodeName.toLowerCase()?this.form=a:(this.form=$Base.cE("form"),this.input.parentNode.insertBefore(this.form,this.input),b=this.input,this.input.parentNode.removeChild(this.input),this.form.appendChild(b)),this.form.method="post"),this.options.autoSubmit||(this.form.onsubmit=function(){return!1}),$Base.addEvent(this.input,"focus",this.bind(this.inputFocus)),$Base.addEvent(this.input,"blur",this.bind(this.inputBlur)),$Base.addEvent(this.input,"keyup",this.bind(this.keyupListener)),$Base.addEvent(this.input,"keydown",this.bind(this.keydownListener)),this.evt=null,this.options.evt&&(this.evt=$Base.$(this.options.evt))&&$Base.addEvent(this.evt,"click",this.bind(this.btnClick))},bind:function(a,b){var c=this;return function(){var e,d=null;if("undefined"!=typeof b){for(e=0;e<arguments.length;e++)b.push(arguments[e]);d=b}else d=arguments;return a.apply(c,d)}},btnClick:function(){this.submit()},inputBlur:function(){""==this.input.value?(this.input.value=this.options.text,this._U="",this.hiddenWrapper()):this.hiddenWrapper(),this.multipleTips(!1)},inputFocus:function(){this.input.value==this.options.text&&(this.input.value="",this._U="",this.multipleTips(!0)),this.dataTrigger(!1)},keyupListener:function(a){var c,d,e,f,g,b=window.event?window.event.keyCode:a.keyCode;switch(b){case 38:if(null!=this.wrapper&&""!=this.wrapper.innerHTML&&this._enabled&&this.wrapper.firstChild.tBodies){for(c=this.wrapper.firstChild.tBodies[0],d=c.rows,e=d.length,-1==this._index?this._index=e-1:this._index--,(this._index<0||this._index>e-1)&&(this._index=e-1),f=0;e>f;f++)d[f]._over=f==this._index?!0:!1,this.setColor(d[f]);this.input.value=(d[this._index].getAttribute("ref")||"").split(",")[0]}break;case 40:if(null!=this.wrapper&&""!=this.wrapper.innerHTML&&this._enabled&&this.wrapper.firstChild.tBodies){for(c=this.wrapper.firstChild.tBodies[0],d=c.rows,e=d.length,-1==this._index?this._index=0:this._index++,(this._index>e-1||this._index<0)&&(this._index=0),f=0;e>f;f++)d[f]._over=f==this._index?!0:!1,this.setColor(d[f]);this.input.value=(d[this._index].getAttribute("ref")||"").split(",")[0]}break;default:g=this,g.multipleTips(!1),g.dataTrigger(!0)}},keydownListener:function(a){var c,b=window.event?window.event.keyCode:a.keyCode;13==b&&(c=this,c._hidden=!1,c.submit(!0),c.hiddenWrapper(),setTimeout(function(){c.input.blur()},10))},dataTrigger:function(a){var b,c,d,e,f,g;this._index=-1,b=a?this.input.value:this._U||this.input.value,this.options.multiple&&(c=b.split(/[,，;； ]{1}/),c.length>1&&(b=c[c.length-1],this.hiddenWrapper())),this._U!=b?(this._U=b,""!=b?"key_"+b in this._cache?this.dataFill():(null==this._R&&(this._R=$Base.cE("div"),this._R.style.display="none",document.body.insertBefore(this._R,document.body.lastChild)),d=$Base.cE("script"),e=this,f=e.options.resultVar,g=this.url+"?"+["q="+encodeURIComponent(encodeURIComponent(b)),"type="+this.options.types.join(","),"n="+f,"ls="+this.options.status.join(","),"key="+this.options.shortcutKey,"order="+this.options.orderBy,"rows="+this.options.rows,"_r="+(new Date).getTime()].join("&"),d.setAttribute("charset","gb2312"),d.setAttribute("type","text/javascript"),d.setAttribute("src",g),this._R.appendChild(d),d.onload=d.onreadystatechange=function(){this.readyState&&"loaded"!=this.readyState&&"complete"!=this.readyState||(e._cache["key_"+b]=window[f],e.dataFill(),d.onload=d.onreadystatechange=null,window[f]=null,this.parentNode.removeChild(this))}):this.hiddenWrapper()):""!=this._U&&this.showWrapper()},hiddenWrapper:function(){0==this._hidden&&null!=this.wrapper&&(this.wrapper.style.display="none")},showWrapper:function(){null!=this.wrapper&&(this.wrapper.style.display="")},multipleTips:function(a){this.options.multiple&&(a?(null==this.multiple&&(this.multiple=$Base.cE("div"),this.multiple.style.cssText="display:none;z-index:100000;position:absolute;background:url(http://i.ssimg.cn/images/www/suggest_info.gif) no-repeat;height:56px;position:absolute;width:129px;",this.input.parentNode.insertBefore(this.multiple,this.input)),this.setPosition(this.multiple),this.multiple.style.display="block"):this.multiple&&(this.multiple.style.display="none"))},dataFill:function(){var b,c,d,e,f,g,h,i,j,k,l,m,n,a=this._U;if("key_"+a in this._cache&&null!=this._cache["key_"+a]&&void 0!=this._cache["key_"+a]){if(null==this.wrapper&&(this.wrapper=$Base.cE("div"),this.wrapper.id="ssajax_lib_suggest_result_layer_"+this.input.id,this.wrapper.className=this.options.className,this.input.parentNode.insertBefore(this.wrapper,this.input)),this.wrapper.style.cssText="z-index:9999;width:"+this.options.width+";opacity:"+this.options.opacity+";filter:alpha(opacity:"+100*this.options.opacity+");position:absolute;display:none;border:1px dashed #ccc",this.setPosition(this.wrapper),b=$Base.cE("table"),c=$Base.cE("tbody"),d=$Base.cE("thead"),e=$Base.cE("tfoot"),f=$Base.cE("tr"),b.border="0",b.cellPadding="0",b.cellSpacing="0",b.style.cssText="line-height:18px;background:#FFF;font-size:12px;text-align:center;color:#666;width:100%;font-weight:normal",f.style.cssText="background:#cce8f8;height:22px;line-height:22px;overflow:hidden;font-weight:normal",null!=this.options.header&&this.options.header.show&&this.options.header.columns&&this.options.header.columns.length>0){for(g=$Base.cE("th"),g.innerHTML="选项",g.style.cssText=this._tableCssText.thead["选项"],f.appendChild(g),h=0;h<this.options.header.columns.length;h++)g=$Base.cE("th"),g.innerHTML=this.options.header.columns[h],g.style.cssText=this._tableCssText.thead[this.options.header.columns[h]],f.appendChild(g);d.appendChild(f),b.appendChild(d)}for(i=this._cache["key_"+a]||{summary:{total:0},datas:[]},j=i.datas.length>this.options.rows?this.options.rows:i.datas.length,this._enabled=j>0,h=0;j>h;h++){for(k=$Base.cE("tr"),k.setAttribute("ref",i.datas[h].join(",")),k.style.cursor="pointer",k.index=h,l=this,k.onmouseover=function(){var a,b,c,d;if(null!=l.wrapper&&""!=l.wrapper.innerHTML&&l.wrapper.firstChild.tBodies)for(a=l.wrapper.firstChild.tBodies[0],b=a.rows,c=b.length,d=0;c>d;d++)b[d]._over=!1,l.setColor(b[d]);this._over=!0,l.setColor(this)},k.onmouseout=function(){this._over=!1,l.setColor(this)},k.onmousedown=function(){l._index=this.index,l._hidden=!0},k.onclick=function(){l._hidden=!1,this._over=!1,l.hiddenWrapper(),l.setColor(this),l.submit()},m=$Base.cE("td"),m.style.wordBreak="break-all",m.hidefocus="true",m.style.padding="1px",m.innerHTML=this.columns["选项"](i.datas[h],a),m.style.cssText=this._tableCssText.tbody["选项"],k.appendChild(m),n=0;n<this.options.header.columns.length;n++)if(m=$Base.cE("td"),m.style.wordBreak="break-all",m.hidefocus="true",m.style.padding="1px",m.style.cssText=this._tableCssText.tbody[this.options.header.columns[n]],m.innerHTML=this.columns[this.options.header.columns[n]](i.datas[h],a),k.appendChild(m),0==i.datas[h][5]){m.colSpan=this.options.header.columns.length,m.innerHTML="",m.innerHTML=this.columns["简称"](i.datas[h],a),m.style.cssText=this._tableCssText.tbody["简称"];break}m=null,c.appendChild(k)}0==j&&(k=$Base.cE("tr"),m=$Base.cE("td"),k.style.cssText="background:#FFF;height:25px;line-height:25px;overflow:hidden;color:#999",m.colSpan=this.options.header.columns.length+1,m.style.cssText="text-align:center",m.innerHTML="未找到符合条件的结果",k.appendChild(m),c.appendChild(k)),i.summary.total>10&&this.options.more&&(k=$Base.cE("tr"),m=$Base.cE("td"),k.style.cssText="background:#FFF;height:22px;line-height:22px;overflow:hidden;color:#999;text-align:center",m.style.padding="1px",m.hidefocus="true",m.colSpan=this.options.header.columns.length+1,m.innerHTML='<a href="http://quote.stockstar.com/search.aspx?keyword='+a+'" target="_blank">查看全部&gt;&gt;</a>',k.onmousedown=function(){l._hidden=!0},k.onclick=function(){l._hidden=!1,l.hiddenWrapper()},k.appendChild(m),e.appendChild(k)),b.appendChild(c),b.appendChild(e),this.wrapper.innerHTML="",this.wrapper.appendChild(b),this.showWrapper()}else this.hiddenWrapper()},setColor:function(a){var b="";b=a._over?"#FEF175":"#FFFFFF",a.style.backgroundColor=b},setPosition:function(a){var g,h,i,b=$Base.offset(this.input),c=b.top,d=b.left,e=[1*this.input.parentNode.style.borderTopWidth.replace("px",""),2*this.input.parentNode.style.borderLeftWidth.replace("px","")],f=[0,0];a.style.top!=c+"px"&&(a.style.top=c-e[0]+f[0]+"px"),a.style.left!=d+"px"&&(a.style.left=d-e[1]+f[1]+"px"),g=this.input.style.borderTopWidth,h=this.input.style.borderBottomWidth,i=this.input.clientHeight,i+=""!=g?1*g.replace("px",""):2,i+=""!=h?1*h.replace("px",""):2,a.style.marginTop!=i+"px"&&(a.style.marginTop=i+"px")},getSelectData:function(){var b,c,d,e,f,a=this._index;return null!=this.wrapper&&""!=this.wrapper.innerHTML&&this.wrapper.firstChild.tBodies?(b=this.wrapper.firstChild.tBodies[0],c=b.rows,d=c.length,0>a&&(a=0),a>d-1&&(a=d-1),e=c[a],f=(e.getAttribute("ref")||"").split(","),0==f.length?null:f):null},"goto":function(a,b,c,d){var e=this;b=b||!1,e.form.action=a,e.form.method=c||"post",e.form.target=d||"_blank",e.form.onsubmit=function(){return!0},b||(e.form.submit(),e.form.onsubmit=function(){return!1})},submit:function(a){var c,d,e,f,g,i,j,k,l,m,b=this._index;if(a=a||!1,null==this.wrapper||""==this.wrapper.innerHTML||!this.wrapper.firstChild.tBodies)return j="http://quote.stockstar.com/stock/exdir.aspx?code="+this.input.value,this.goto(j,a),!1;if(c=this.wrapper.firstChild.tBodies[0],d=c.rows,e=d.length,0>b){if(f=this.input.value,g=!1,1==d.length){if(i=(d[0].getAttribute("ref")||"").split(","),0==i.length)return!1;i.length>=3&&(i[0]==f||i[1].toLowerCase()==f.toLowerCase()||i[2].toLowerCase()==f.toLowerCase())&&(g=!0,b=0)}if(!g&&this.options.autoSubmit)return j="http://quote.stockstar.com/stock/exdir.aspx?code="+f,k="post",this.goto(j,a),!1}if(0>b&&(b=0),b>e-1&&(b=e-1),l=d[b],l._over=!1,this.setColor(l),m=(l.getAttribute("ref")||"").split(","),0==m.length)return!1;if(this.input.value=m[0],!this.options.autoSubmit&&null!=this.options.callback)return this.options.callback(this,m,a),!1;switch(j="http://quote.stockstar.com/stock/exdir.aspx?code="+m[0]+"&mk="+m[4]+"&securtytype="+m[5]+"&target=quotesearch",k="post",m[5]){case"101":case"102":case"103":case"104":case"105":j="http://q.ssajax.cn/info/handler/redirect.ashx?url="+encodeURIComponent("http://stock.quote.stockstar.com/"+m[0]+".shtml");break;case"201":case"202":case"203":case"204":j="http://q.ssajax.cn/info/handler/redirect.ashx?url="+encodeURIComponent("http://index.quote.stockstar.com/"+m[0]+".shtml");break;case"300":case"301":j="http://q.ssajax.cn/info/handler/redirect.ashx?url="+encodeURIComponent("http://if.quote.stockstar.com/"+m[0]+".shtml");break;case"401":case"403":case"404":j="http://q.ssajax.cn/info/handler/redirect.ashx?url="+encodeURIComponent("http://bond.quote.stockstar.com/"+m[0]+".shtml");break;case"500":case"501":case"502":case"503":case"504":j="http://q.ssajax.cn/info/handler/redirect.ashx?url="+encodeURIComponent("http://fund.stockstar.com/funds/"+m[0]+".shtml");break;case"0":j=this._shortKeyMap[m[0]]?"http://q.ssajax.cn/info/handler/redirect.ashx?url="+encodeURIComponent(this._shortKeyMap[m[0]]):"http://quote.stockstar.com/stock/exdir.aspx?code="+m[0]+"&mk=null&securtytype=-1&target=quotesearch";break;case"9001":"000198QX"==m[0]&&(j="http://q.ssajax.cn/info/handler/redirect.ashx?url="+encodeURIComponent("http://resource.stockstar.com/DataCenter/StockData/yeb.htm"));break;default:j="http://quote.stockstar.com/stock/exdir.aspx?code="+m[0]+"&mk="+m[4]+"&securtytype="+m[5]+"&target=quotesearch"}this.goto(j,a,k)}}),window.StockSuggest=StockSuggest}();