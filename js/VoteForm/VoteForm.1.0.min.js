/*
	投票数据解析模块
	上传日期：2013年6月24日 17:16:37
	采用UglifyJS压缩	
*/
!function(){function c(a,c){this.containerID=a,this.data=c,this._form=null,this._template='<div class="title">[$.title]</div><ul class="content">[$.content]</ul><input type="hidden" name="vHidden[$.id]" value="[$.maximum]" /><input type="hidden" name="vIssues" value="[$.id]" />',this._templateli='<li><input type="[$.type]" id="vItem[$.item.id]" value="[$.item.id]" name="vIssue[$.issue.id]" /><label for="vItem[$.item.id]">[$.item.name]</label></li>',this._render=function(){var c,d,e,f,g,h,i,j,k,l,m,n,o,p,a=this.data.issues||[];for(c=0;c<a.length;c++){for(d=a[c].id,e=a[c].name,f=a[c].maximum,f=1>f?1:f,f=f>a[c].items.length?a[c].items.length:f,g=1==f?"radio":"checkbox",h=this._template,i="",j=0;j<a[c].items.length;j++)k=this._templateli,k=k.replace(/\[\$\.type\]/g,g),k=k.replace(/\[\$\.issue\.id\]/g,a[c].id),k=k.replace(/\[\$\.item\.id\]/g,a[c].items[j].id),k=k.replace(/\[\$\.item\.name\]/g,a[c].items[j].name),i+=k;for(h=h.replace(/\[\$\.title\]/g,e),h=h.replace(/\[\$\.content\]/g,i),h=h.replace(/\[\$\.id\]/g,d),h=h.replace(/\[\$\.maximum\]/g,f),l=b.$aE("div","detail",null,null,this._form),l.innerHTML=h,m=l.getElementsByTagName("input"),n=0;n<m.length;n++)"checkbox"==m[n].type&&f<a[c].items.length&&function(a,c,d){b.addEvent(a,"click",function(){var b,e,a=c.getElementsByTagName("input");if(this.checked){for(b=0,e=0;e<a.length;e++)"checkbox"==a[e].type&&a[e].checked&&(b+=1);if(b>=d)for(e=0;e<a.length;e++)"checkbox"!=a[e].type||a[e].checked||a[e].setAttribute("disabled","disabled")}else for(e=0;e<a.length;e++)"checkbox"!=a[e].type||a[e].checked||a[e].removeAttribute("disabled")})}(m[n],l,f)}o=b.$E("input"),o.type="hidden",o.name="vId",o.value=this.data.id,this._form.appendChild(o),i=b.$aE("div","commit",null,null,this._form),l=b.$E("input"),l.type="button",l.className="ui-button-submit",l.value="投票",i.appendChild(l),m=b.$E("input"),m.type="button",m.className="ui-button-view",m.value="查看",i.appendChild(m),p=this,b.addEvent(l,"click",function(){var a,b,c,d,e,f,g;for(p._form.action="http://survey.stockstar.com/vote/Polling.ashx",a=p._form.childNodes,b=0;b<a.length;b++)if("div"==a[b].nodeName.toLowerCase()&&"detail"==a[b].className){for(c=a[b].getElementsByTagName("input"),d=0,e=0,f=0;f<c.length;f++)if("hidden"==c[f].type&&"vIssues"==c[f].name){d=Number(c[f].value)||0;break}for(f=0;f<c.length;f++)if("hidden"==c[f].type&&c[f].name=="vHidden"+d){e=Number(c[f].value)||0;break}for(g=0,f=0;f<c.length;f++)("checkbox"==c[f].type||"radio"==c[f].type)&&(g+=c[f].checked?1:0);if(0==g)return alert("投票失败，请确定每一项都进行了选择！"),!1;if(g>e)return alert("投票失败，请确定每一项的最大可选数量！"),!1}p._form.submit()}),b.addEvent(m,"click",function(){p._form.action="http://survey.stockstar.com/vote/view_"+p.data.id+".html",p._form.submit()})},this.containerID=b.$(this.containerID),this.containerID&&null!=this.data&&void 0!=this.data&&(this._form=b.$aE("form",null,null,null,this.containerID),this._form.id="voteForm"+a,this._form.method="post",this._form.target="_blank",this._render())}Object.extend=function(a,b){for(property in b)a[property]=b[property];return a};var b={$:function(a){return"string"==typeof a?document.getElementById(a):a},$E:function(a){return document.createElement(a||"div")},$M:function(a,b,c){var d,e,g;if(b=b||{},c=c||{},a&&b&&c){e=a.style;for(g in b)d=b[g],e[g]=d;for(g in c)d=b[g],a.setAttribute=d}},$aE:function(a,b,c,d,e){e=e||document.body;var f=this.$E(a);return b&&(f.className=b),this.$M(f,c||{},d||{}),e.appendChild(f)},addEvent:function(a,b,c){a.attachEvent?a.attachEvent("on"+b,c):a.addEventListener(b,c,!1)}};window.VoteForm=c}();